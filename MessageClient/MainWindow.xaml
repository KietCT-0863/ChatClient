<Window x:Class="Message_Client.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Message_Client"
        mc:Ignorable="d"
        Title="Message Client - Chat Application" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Tiêu đề -->
        <TextBlock Grid.Row="0" Text="Message Client - Chat Application" 
                   FontSize="24" FontWeight="Bold" 
                   HorizontalAlignment="Center" Margin="0,0,0,20"
                   Foreground="#1E90FF"/>

        <!-- Panel kết nối -->
        <GroupBox Grid.Row="1" Header="Kết nối Server" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Server:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Grid.Column="1" Name="txtServerAddress" Text="" VerticalAlignment="Center" Margin="0,0,10,0"
                         ToolTip="Nhập địa chỉ IP hoặc hostname của server"/>
                
                <TextBlock Grid.Column="2" Text="Port:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Grid.Column="3" Name="txtServerPort" Text="" VerticalAlignment="Center" Margin="0,0,10,0"
                         ToolTip="Nhập port từ 1 đến 65535"/>
                
                <TextBlock Grid.Column="4" Text="Tên:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Grid.Column="5" Name="txtUsername" Text="" VerticalAlignment="Center" Margin="0,0,10,0"
                         ToolTip="Nhập tên hiển thị trong chat"/>
                
                <Button Grid.Column="6" Name="btnConnect" Content="Kết nối" 
                        Width="80" Margin="0,0,10,0" Click="BtnConnect_Click"/>
                <Button Grid.Column="7" Name="btnDisconnect" Content="Ngắt kết nối" 
                        Width="100" Margin="0,0,10,0" Click="BtnDisconnect_Click" IsEnabled="False"/>
                
                <TextBlock Grid.Column="8" Name="lblConnectionStatus" Text="Chưa kết nối" 
                           VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Red" FontWeight="Bold"/>
            </Grid>
        </GroupBox>

        <!-- Khu vực chat -->
        <GroupBox Grid.Row="2" Header="Chat" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Danh sách tin nhắn -->
                <Border Grid.Row="0" BorderBrush="#CCCCCC" BorderThickness="1" Background="#F9F9F9" Margin="0,0,0,10">
                    <ListBox Name="lstMessages" 
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             Background="Transparent"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="5" Padding="8" CornerRadius="5">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#E6F3FF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="System">
                                                    <Setter Property="Background" Value="#FFF8DC"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="Error">
                                                    <Setter Property="Background" Value="#FFE6E6"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="Connected">
                                                    <Setter Property="Background" Value="#E6FFE6"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="Disconnected">
                                                    <Setter Property="Background" Value="#FFE6E6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,3">
                                            <TextBlock Text="{Binding Time}" FontSize="11" Foreground="Gray" Margin="0,0,10,0"/>
                                            <TextBlock Text="{Binding Sender}" FontSize="11" FontWeight="Bold" Foreground="#333"/>
                                        </StackPanel>
                                        
                                        <TextBlock Grid.Row="1" Text="{Binding Message}" TextWrapping="Wrap" FontSize="12"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

                <!-- Nút xóa tin nhắn -->
                <Button Grid.Row="1" Name="btnClearMessages" Content="Xóa tin nhắn" 
                        Width="100" HorizontalAlignment="Right" Margin="0,0,0,10"
                        Click="BtnClearMessages_Click"/>
            </Grid>
        </GroupBox>

        <!-- Gửi tin nhắn -->
        <GroupBox Grid.Row="3" Header="Gửi tin nhắn" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" Name="txtMessage" 
                         VerticalAlignment="Center" Margin="0,0,10,0"
                         KeyDown="TxtMessage_KeyDown" IsEnabled="False"
                         FontSize="12" Padding="5"/>
                <Button Grid.Column="1" Name="btnEmoji" Content="😊" 
                        Width="40" Margin="0,0,10,0" Click="BtnEmoji_Click" IsEnabled="False"
                        FontSize="16" Padding="2" ToolTip="Chọn biểu cảm"/>
                <Button Grid.Column="2" Name="btnSend" Content="Gửi" 
                        Width="80" Click="BtnSend_Click" IsEnabled="False"
                        FontSize="12" Padding="5"/>
            </Grid>
        </GroupBox>

        <!-- Status bar -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <TextBlock Name="lblStatus" Text="Sẵn sàng kết nối"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Name="lblTime" Text=""/>
            </StatusBarItem>
        </StatusBar>

        <!-- Popup chọn biểu cảm -->
        <Popup Name="emojiPopup" Placement="Top" PlacementTarget="{Binding ElementName=btnEmoji}" 
               IsOpen="False" StaysOpen="False" AllowsTransparency="True">
            <Border Background="White" BorderBrush="#CCCCCC" BorderThickness="1" 
                    CornerRadius="5" Padding="10" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="2" BlurRadius="5"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="Chọn biểu cảm:" FontWeight="Bold" 
                               Margin="0,0,0,10" HorizontalAlignment="Center"/>
                    
                    <WrapPanel Grid.Row="1" Name="emojiPanel" Width="200" Height="120">
                        <!-- Các biểu cảm sẽ được thêm bằng code -->
                    </WrapPanel>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</Window>
